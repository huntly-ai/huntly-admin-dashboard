{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/felipesantos/Documents/Huntly/huntly-admin-dashboard/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient()\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 65, "column": 0}, "map": {"version":3,"sources":["file:///Users/felipesantos/Documents/Huntly/huntly-admin-dashboard/app/api/dashboard/metrics/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { prisma } from \"@/lib/prisma\"\n\nexport async function GET() {\n  try {\n    // Get counts\n    const [leadsCount, clientsCount, projectsCount, activeProjectsCount] = await Promise.all([\n      prisma.lead.count(),\n      prisma.client.count({ where: { status: \"ACTIVE\" } }),\n      prisma.project.count(),\n      prisma.project.count({ where: { status: \"IN_PROGRESS\" } }),\n    ])\n\n    // Get financial data\n    const transactions = await prisma.transaction.findMany({\n      where: {\n        date: {\n          gte: new Date(new Date().getFullYear(), 0, 1), // This year\n        },\n      },\n    })\n\n    const totalIncome = transactions\n      .filter((t) => t.type === \"INCOME\")\n      .reduce((sum, t) => sum + t.amount, 0)\n\n    const totalExpense = transactions\n      .filter((t) => t.type === \"EXPENSE\")\n      .reduce((sum, t) => sum + t.amount, 0)\n\n    const profit = totalIncome - totalExpense\n\n    // Get leads by status\n    const leadsByStatus = await prisma.lead.groupBy({\n      by: [\"status\"],\n      _count: true,\n    })\n\n    // Get monthly revenue for the last 6 months\n    const sixMonthsAgo = new Date()\n    sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6)\n\n    const monthlyTransactions = await prisma.transaction.findMany({\n      where: {\n        date: {\n          gte: sixMonthsAgo,\n        },\n      },\n      orderBy: {\n        date: \"asc\",\n      },\n    })\n\n    // Group by month\n    const monthlyData = monthlyTransactions.reduce((acc: any, transaction) => {\n      const month = transaction.date.toLocaleString(\"pt-BR\", { month: \"short\", year: \"numeric\" })\n      if (!acc[month]) {\n        acc[month] = { month, income: 0, expense: 0 }\n      }\n      if (transaction.type === \"INCOME\") {\n        acc[month].income += transaction.amount\n      } else {\n        acc[month].expense += transaction.amount\n      }\n      return acc\n    }, {})\n\n    const monthlyRevenue = Object.values(monthlyData)\n\n    // Get recent projects\n    const recentProjects = await prisma.project.findMany({\n      take: 5,\n      orderBy: {\n        createdAt: \"desc\",\n      },\n      include: {\n        client: {\n          select: {\n            name: true,\n          },\n        },\n      },\n    })\n\n    return NextResponse.json({\n      counts: {\n        leads: leadsCount,\n        clients: clientsCount,\n        projects: projectsCount,\n        activeProjects: activeProjectsCount,\n      },\n      financial: {\n        totalIncome,\n        totalExpense,\n        profit,\n      },\n      leadsByStatus,\n      monthlyRevenue,\n      recentProjects,\n    })\n  } catch (error) {\n    console.error(\"Error fetching dashboard metrics:\", error)\n    return NextResponse.json(\n      { error: \"Failed to fetch dashboard metrics\" },\n      { status: 500 }\n    )\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe;IACpB,IAAI;QACF,aAAa;QACb,MAAM,CAAC,YAAY,cAAc,eAAe,oBAAoB,GAAG,MAAM,QAAQ,GAAG,CAAC;YACvF,yHAAM,CAAC,IAAI,CAAC,KAAK;YACjB,yHAAM,CAAC,MAAM,CAAC,KAAK,CAAC;gBAAE,OAAO;oBAAE,QAAQ;gBAAS;YAAE;YAClD,yHAAM,CAAC,OAAO,CAAC,KAAK;YACpB,yHAAM,CAAC,OAAO,CAAC,KAAK,CAAC;gBAAE,OAAO;oBAAE,QAAQ;gBAAc;YAAE;SACzD;QAED,qBAAqB;QACrB,MAAM,eAAe,MAAM,yHAAM,CAAC,WAAW,CAAC,QAAQ,CAAC;YACrD,OAAO;gBACL,MAAM;oBACJ,KAAK,IAAI,KAAK,IAAI,OAAO,WAAW,IAAI,GAAG;gBAC7C;YACF;QACF;QAEA,MAAM,cAAc,aACjB,MAAM,CAAC,CAAC,IAAM,EAAE,IAAI,KAAK,UACzB,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,EAAE,MAAM,EAAE;QAEtC,MAAM,eAAe,aAClB,MAAM,CAAC,CAAC,IAAM,EAAE,IAAI,KAAK,WACzB,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,EAAE,MAAM,EAAE;QAEtC,MAAM,SAAS,cAAc;QAE7B,sBAAsB;QACtB,MAAM,gBAAgB,MAAM,yHAAM,CAAC,IAAI,CAAC,OAAO,CAAC;YAC9C,IAAI;gBAAC;aAAS;YACd,QAAQ;QACV;QAEA,4CAA4C;QAC5C,MAAM,eAAe,IAAI;QACzB,aAAa,QAAQ,CAAC,aAAa,QAAQ,KAAK;QAEhD,MAAM,sBAAsB,MAAM,yHAAM,CAAC,WAAW,CAAC,QAAQ,CAAC;YAC5D,OAAO;gBACL,MAAM;oBACJ,KAAK;gBACP;YACF;YACA,SAAS;gBACP,MAAM;YACR;QACF;QAEA,iBAAiB;QACjB,MAAM,cAAc,oBAAoB,MAAM,CAAC,CAAC,KAAU;YACxD,MAAM,QAAQ,YAAY,IAAI,CAAC,cAAc,CAAC,SAAS;gBAAE,OAAO;gBAAS,MAAM;YAAU;YACzF,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE;gBACf,GAAG,CAAC,MAAM,GAAG;oBAAE;oBAAO,QAAQ;oBAAG,SAAS;gBAAE;YAC9C;YACA,IAAI,YAAY,IAAI,KAAK,UAAU;gBACjC,GAAG,CAAC,MAAM,CAAC,MAAM,IAAI,YAAY,MAAM;YACzC,OAAO;gBACL,GAAG,CAAC,MAAM,CAAC,OAAO,IAAI,YAAY,MAAM;YAC1C;YACA,OAAO;QACT,GAAG,CAAC;QAEJ,MAAM,iBAAiB,OAAO,MAAM,CAAC;QAErC,sBAAsB;QACtB,MAAM,iBAAiB,MAAM,yHAAM,CAAC,OAAO,CAAC,QAAQ,CAAC;YACnD,MAAM;YACN,SAAS;gBACP,WAAW;YACb;YACA,SAAS;gBACP,QAAQ;oBACN,QAAQ;wBACN,MAAM;oBACR;gBACF;YACF;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,QAAQ;gBACN,OAAO;gBACP,SAAS;gBACT,UAAU;gBACV,gBAAgB;YAClB;YACA,WAAW;gBACT;gBACA;gBACA;YACF;YACA;YACA;YACA;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qCAAqC;QACnD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAoC,GAC7C;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}